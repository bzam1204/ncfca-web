status: pending

# 02 — Criar/Ajustar Actions por operação

## Objetivo

Expor operações do `AdminGateway` via Actions server-side com `auth() → Inject → gateway`, removendo leitura de token no cliente. Padronizar invalidações (`QueryKeys`/`NextKeys`).

## Arquivos e caminhos (criar/editar)

- Criar: `src/infrastructure/actions/admin/get-club-members.action.ts`
- Criar: `src/infrastructure/actions/admin/get-club-charts.action.ts`
- Criar: `src/infrastructure/actions/admin/get-user-family.action.ts`
- Validar/alinhar existentes:
  - `src/infrastructure/actions/admin/approve-club-request.action.ts`
  - `src/infrastructure/actions/admin/reject-club-request.action.ts`

## Contratos e estruturas

- `getClubMembers(clubId: string): Promise<ClubMemberDto[]>`
- `getClubCharts(clubId: string): Promise<AdminClubChartsDto>`
- `getUserFamily(userId: string): Promise<{ user: UserDto; family: FamilyResponseDto }>`
- Todas as Actions:
  - Chamam `auth()`; se sem token → `throw redirect('/login')` ou erro 401.
  - Usam `Inject.AdminGateway(token)` e delegam.
  - Tratam erros HTTP expondo mensagem do body.
  - Cache/Tag: usar `NextKeys` adequadas (e.g., `NextKeys.admin.clubs`, `NextKeys.clubs.details(clubId)`).

## Regras de negócio e validações

- Somente Admin executa rotas Admin (validar roles do usuário via `session.user.roles`).
- Revalidações coerentes com efeitos: aprovar/rejeitar → invalida pendentes, membros, charts.

## Passo a passo

1. Implementar Actions com padrão comum (auth, inject, call, handle error).
2. Definir tags `NextKeys` novas se necessário (charts/members por clube) e exportá-las.
3. Checar Actions existentes (approve/reject) para garantir revalidações esperadas.

## Critérios de aceite

- Actions novas exportadas e tipadas; builds dos importadores passam.
- Uso de `NextKeys` e não leitura de token no cliente.

## Testes mínimos (âncoras)

- Unit: mock de `Inject.AdminGateway` e verificação de delegação por Action.
- E2E manual: rota de dashboard atualiza após aprovar/rejeitar (tags revalidadas).

## Notas de versão/refs (Context7)

- Next.js 15 Server Actions (`use server`).
- `openapi.json` para contratos mapeados.
