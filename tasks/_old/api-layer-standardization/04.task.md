status: pending

# 04 — Refatorar Páginas Server para Gateways/Actions

## Objetivo
Remover fetch direto de páginas server Admin, delegando para Actions/Gateways com `auth()` e `Inject`.

## Arquivos e caminhos (criar/editar)
- Editar: `src/app/(admin)/admin/dashboard/affiliations/page.tsx`
- Editar: `src/app/(admin)/admin/dashboard/users/[userId]/page.tsx`
- Criar (se necessário): Actions específicas reutilizáveis (ex.: `get-user-family.action.ts`).

## Contratos e estruturas
- Páginas devem:
  - Chamar Actions (ou gateways via server component) para obter dados.
  - Não construir headers/token manualmente.
  - Manter tipagem com DTOs existentes (`AffiliationDto`, `FamilyResponseDto`, `UserDto`).

## Regras de negócio e validações
- Verificar role Admin antes do acesso (já existente via `auth()`), sem lógica duplicada.
- `cache: 'no-store'` substituído por `revalidateTag(NextKeys...)` nas Actions quando aplicável.

## Passo a passo
1) Substituir a função `getAffiliations` por chamada a `get-affiliations.action.ts` já existente.
2) Em `users/[userId]/page.tsx`, substituir fetch por `get-user-family.action.ts` (a criar na Task 02).
3) Remover imports de `process.env.NEXT_PUBLIC_BACKEND_URL` e headers.

## Critérios de aceite
- Comando retorna vazio: `rg -n "fetch\(.*admin/" src/app/(admin)`.
- Páginas compilam e exibem dados como antes.

## Testes mínimos (âncoras)
- Smoke manual: páginas de afiliações e dossiê do usuário renderizam OK logado como Admin.

## Notas de versão/refs (Context7)
- Next.js 15, Server Components + Actions.

